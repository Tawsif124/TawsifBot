<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶ö‡¶ø‡¶§‡ßç‡¶∞ ‡¶ì ‡¶ï‡¶•‡ßã‡¶™‡¶ï‡¶•‡¶®</title>
    <!-- Google Fonts for Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .container {
            max-width: 900px;
        }
        /* Style for user messages */
        .user-message {
            background-color: #e0e7ff;
            align-self: flex-end;
            border-bottom-right-radius: 0;
            word-wrap: break-word; /* Ensures long words wrap */
        }
        /* Style for bot messages */
        .bot-message {
            background-color: #ffffff;
            align-self: flex-start;
            border-bottom-left-radius: 0;
            word-wrap: break-word; /* Ensures long words wrap */
        }
        .chat-log {
            max-height: 70vh; /* Increased height for chat log */
            overflow-y: auto;
            scroll-behavior: smooth;
            white-space: pre-wrap; /* Preserve whitespace and line breaks */
        }
        /* Hide scrollbar for Chrome, Safari and Opera */
        .chat-log::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .chat-log {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        /* Style for file input button/label */
        .file-upload-label {
            cursor: pointer;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4a5568;
            transition: all 0.2s;
        }
        .file-upload-label:hover {
            color: #2d3748;
        }
        .image-preview-item {
            position: relative;
            display: inline-block;
        }
        .remove-image-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            line-height: 1;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center py-6">

    <div class="container mx-auto p-6 bg-white rounded-xl shadow-lg flex flex-col h-full">
        <h1 class="text-3xl font-bold text-center text-indigo-600">Picture Analyser</h1>
        <p class="text-center text-indigo-400 font-semibold text-sm mb-4">Tawsif</p>
        <p class="text-center text-gray-600 mb-6">‡¶è‡¶ï ‡¶¨‡¶æ ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶õ‡¶¨‡¶ø (‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ß®‡¶ü‡¶æ) ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßã ‡¶è‡¶¨‡¶Ç ‡¶è‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßã‡•§</p>
        
        <!-- Chat Log -->
        <div id="chat-log" class="chat-log flex-grow p-4 space-y-4 bg-gray-50 rounded-lg border border-gray-200 mb-4">
            <!-- Initial bot message -->
            <div class="bot-message max-w-[80%] p-3 rounded-xl shadow-sm text-gray-800">
                <p>‡¶Ü‡¶Æ‡¶ø ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§! ‡¶è‡¶ï‡¶ü‡¶ø ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶Æ‡¶æ‡¶ï‡ßá ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶∏‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ üòä</p>
            </div>
            <!-- Chat messages will be appended here -->
        </div>

        <!-- Image Previews -->
        <div id="image-preview-container" class="flex flex-wrap justify-start items-center gap-2 px-2 py-1 mb-2"></div>
        
        <!-- Message Input Area with integrated file upload -->
        <div class="flex items-end space-x-2">
            <!-- File upload input and label (integrated) -->
            <div class="flex items-center space-x-2 p-2 rounded-full bg-gray-100 border border-gray-300">
                <label for="image-upload" class="file-upload-label">
                    <!-- SVG for image icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-500 hover:text-indigo-600 transition-colors duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span class="sr-only">‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</span>
                </label>
                <input type="file" id="image-upload" accept="image/*" class="hidden" multiple>
            </div>
            
            <input type="text" id="user-input" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡ßá‡¶ñ‡ßã..." class="flex-grow p-3 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <button id="send-btn" class="bg-green-500 text-white font-bold py-3 px-6 rounded-full shadow-md hover:bg-green-600 transition-transform transform hover:scale-105">
                ‡¶™‡¶æ‡¶†‡¶æ‡¶®
            </button>
        </div>
        
    </div>

    <script>
        // DOM elements
        const imageUpload = document.getElementById('image-upload');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const chatLog = document.getElementById('chat-log');

        let uploadedImages = [];
        let chatHistory = [];
        let isProcessing = false;
        const maxFiles = 2;

        // Function to convert image file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        // Function to remove an image
        function removeImage(index) {
            uploadedImages.splice(index, 1);
            renderImagePreviews();
        }

        // Function to render image previews
        function renderImagePreviews() {
            imagePreviewContainer.innerHTML = '';
            uploadedImages.forEach((img, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'image-preview-item';
                
                const image = document.createElement('img');
                image.src = `data:image/png;base64,${img.data}`;
                image.alt = "‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶õ‡¶¨‡¶ø";
                image.className = 'rounded-lg shadow-md max-h-24 object-contain border border-gray-300';
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-image-btn';
                removeBtn.innerHTML = '‚úï';
                removeBtn.onclick = () => removeImage(index);

                previewItem.appendChild(image);
                previewItem.appendChild(removeBtn);
                imagePreviewContainer.appendChild(previewItem);
            });
        }

        // Function to add a message to the chat log
        function addMessage(sender, text, imageBase64 = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `max-w-[80%] p-3 rounded-xl shadow-sm ${sender === 'user' ? 'user-message text-gray-800' : 'bot-message text-gray-800'}`;
            
            if (sender === 'user' && imageBase64) {
                const img = document.createElement('img');
                img.src = `data:image/png;base64,${imageBase64}`;
                img.alt = 'Uploaded Image';
                img.className = 'w-20 h-auto rounded-lg shadow-sm mb-2';
                messageDiv.appendChild(img);
            }
            
            const textElement = document.createElement('p');
            textElement.textContent = text;
            messageDiv.appendChild(textElement);
            
            chatLog.appendChild(messageDiv);
            chatLog.scrollTop = chatLog.scrollHeight;
        }

        // Function to simulate a typing indicator for the bot
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'bot-message max-w-[80%] p-3 rounded-xl shadow-sm text-gray-500 italic';
            typingDiv.innerHTML = '<p>‡¶≤‡¶ø‡¶ñ‡¶õ‡ßá...</p>';
            chatLog.appendChild(typingDiv);
            chatLog.scrollTop = chatLog.scrollHeight;
        }

        // Function to hide the typing indicator
        function hideTypingIndicator() {
            const typingDiv = document.getElementById('typing-indicator');
            if (typingDiv) {
                typingDiv.remove();
            }
        }

        // Event listener for image upload
        imageUpload.addEventListener('change', async (event) => {
            const files = event.target.files;
            
            if (uploadedImages.length >= maxFiles) {
                 const messageContainer = document.createElement('div');
                messageContainer.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center';
                messageContainer.innerHTML = `
                    <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm mx-auto text-center">
                        <p class="text-gray-800">‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ${maxFiles}‡¶ü‡¶ø ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§</p>
                        <button onclick="this.parentElement.parentElement.remove()" class="mt-4 bg-indigo-500 text-white font-semibold py-2 px-4 rounded-full hover:bg-indigo-600">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>
                `;
                document.body.appendChild(messageContainer);
                return;
            }

            const filesToProcess = Array.from(files).slice(0, maxFiles - uploadedImages.length);
            
            for (const file of filesToProcess) {
                const base64 = await fileToBase64(file);
                uploadedImages.push({
                    data: base64,
                    mimeType: file.type
                });
            }
            renderImagePreviews();
            imageUpload.value = ''; // Reset file input to allow re-uploading the same file
        });

        // Main function to handle sending a message
        async function sendMessage() {
            if (isProcessing) return;
            const userMessage = userInput.value.trim();
            if (!userMessage && uploadedImages.length === 0) return;

            isProcessing = true;
            
            const firstImageBase64 = uploadedImages.length > 0 ? uploadedImages[0].data : null;
            addMessage('user', userMessage, firstImageBase64);
            
            userInput.value = '';
            showTypingIndicator();

            try {
                const payloadContents = [];
                
                const tawsifKeywords = [
                    "tawsif", "‡¶§‡ßã‡¶∞ ‡¶∏‡ßç‡¶∞‡¶∑‡ßç‡¶ü‡¶æ", "‡¶§‡ßã‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶Æ‡¶æ‡¶§‡¶æ", "‡¶§‡ßã‡¶ï‡ßá ‡¶ï‡ßá ‡¶¨‡¶æ‡¶®‡¶ø‡ßü‡ßá‡¶õ‡ßá", "‡¶§‡ßã‡¶ï‡ßá ‡¶ï‡ßá ‡¶¨‡¶æ‡¶®‡¶æ‡¶á‡¶õ‡ßá", "‡¶ï‡ßá ‡¶¨‡¶æ‡¶®‡¶ø‡ßü‡ßá‡¶õ‡ßá ‡¶§‡ßã‡¶ï‡ßá", "‡¶§‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Æ‡¶¶‡¶æ‡¶§‡¶æ", "towsif", "‡¶ï‡ßá ‡¶¨‡¶æ‡¶®‡¶æ‡¶á‡¶≤‡ßã", "‡¶ï‡ßá ‡¶¨‡¶æ‡¶®‡¶æ‡¶≤", "‡¶§‡ßà‡¶∞‡¶ø", "‡¶ï‡ßá", "‡¶ï‡ßá ‡¶¨‡¶æ‡¶®‡¶æ‡¶á‡¶õ‡ßá",
                    "‡¶§‡ßã‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø", "‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø", "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø", "what is your name", "who made you", "your creator", "who created you"
                ];
                const lowerCaseUserMessage = userMessage.toLowerCase();
                const isTawsifRelated = tawsifKeywords.some(keyword => lowerCaseUserMessage.includes(keyword));

                let conversationStarter = '';
                
                if (isTawsifRelated) {
                    conversationStarter = `‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡¶¨‡¶ü ‡¶Ø‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ Tawsif Chatbot‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá Tawsif ‡¶®‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶è‡¶ï‡¶ú‡¶® ‡¶Ö‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§ ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßá‡¶â ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶Æ‡¶æ‡¶§‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶∏‡¶æ ‡¶ï‡¶∞‡ßá, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶§‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶∂‡¶Ç‡¶∏‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡ßá ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶ø‡¶®‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞‡ßá Tawsif ‡¶è‡¶∞ ‡¶∏‡ßÉ‡¶ú‡¶®‡¶∂‡ßÄ‡¶≤‡¶§‡¶æ, ‡¶¶‡¶ï‡ßç‡¶∑‡¶§‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶Æ‡¶æ‡¶®‡¶¨‡¶ø‡¶ï ‡¶ó‡ßÅ‡¶£‡¶æ‡¶¨‡¶≤‡ßÄ ‡¶§‡ßÅ‡¶≤‡ßá ‡¶ß‡¶∞‡ßÅ‡¶®‡•§ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶æ‡¶¨‡¶≤‡ßÄ‡¶≤ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶¨‡¶æ ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡¶æ‡¶∑‡¶æ‡¶Ø‡¶º ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶ø‡¶®, ‡¶Ü‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞‡ßá ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶á‡¶Æ‡ßã‡¶ú‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®‡•§`;
                } else if (uploadedImages.length > 0) {
                    conversationStarter = `‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ï‡¶ú‡¶® ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑‡¶ú‡ßç‡¶û ‡¶ö‡¶ø‡¶§‡ßç‡¶∞ ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶ï‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú ‡¶π‡¶≤‡ßã ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§ ‡¶Ö‡¶®‡ßÅ‡¶ö‡ßç‡¶õ‡ßá‡¶¶‡ßá‡•§ ‡¶è‡¶∞‡¶™‡¶∞, ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶ö‡ßç‡¶õ‡ßá‡¶¶‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶¶‡¶ø‡¶®‡•§ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶ö‡ßç‡¶õ‡ßá‡¶¶‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶æ‡¶á‡¶® ‡¶∞‡¶æ‡¶ñ‡¶¨‡ßá‡¶®‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞‡ßá ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶á‡¶Æ‡ßã‡¶ú‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∞ Markdown, LaTeX, ‡¶¨‡¶æ ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶ö‡¶ø‡¶π‡ßç‡¶® ‡¶Ø‡ßá‡¶Æ‡¶® ** , * , $ , # ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§`;
                } else {
                    conversationStarter = `‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶æ‡¶¨‡¶≤‡ßÄ‡¶≤ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡¶¨‡¶ü‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú ‡¶π‡¶≤‡ßã ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶§‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶ï‡¶•‡ßã‡¶™‡¶ï‡¶•‡¶® ‡¶ö‡¶æ‡¶≤‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶¨‡¶æ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡¶æ‡¶∑‡¶æ‡¶Ø‡¶º ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶ø‡¶§‡ßá ‡¶∏‡¶ï‡ßç‡¶∑‡¶Æ‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§ ‡¶Ö‡¶®‡ßÅ‡¶ö‡ßç‡¶õ‡ßá‡¶¶‡ßá‡•§ ‡¶è‡¶∞‡¶™‡¶∞, ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶ö‡ßç‡¶õ‡ßá‡¶¶‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶¶‡¶ø‡¶®‡•§ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶ö‡ßç‡¶õ‡ßá‡¶¶‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶æ‡¶á‡¶® ‡¶∞‡¶æ‡¶ñ‡¶¨‡ßá‡¶®‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞‡ßá ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶á‡¶Æ‡ßã‡¶ú‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∞ Markdown, LaTeX, ‡¶¨‡¶æ ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶ö‡¶ø‡¶π‡ßç‡¶® ‡¶Ø‡ßá‡¶Æ‡¶® ** , * , $ , # ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§`;
                }
                
                const parts = [{ text: conversationStarter }];
                
                if (uploadedImages.length > 0) {
                    uploadedImages.forEach(img => {
                        parts.push({
                            inlineData: {
                                mimeType: img.mimeType,
                                data: img.data
                            }
                        });
                    });
                }
                
                payloadContents.push({ role: "user", parts: parts });
                payloadContents.unshift(...chatHistory);
                payloadContents.push({ role: "user", parts: [{ text: userMessage }] });

                const payload = { contents: payloadContents };

                uploadedImages = [];
                imagePreviewContainer.innerHTML = '';

                const apiKey = "AIzaSyBr5pug_OpHcoVccs0e6_tZB7GQPNVBf-E";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                let response = null;
                let retries = 0;
                const maxRetries = 5;
                const initialDelay = 1000;

                while (retries < maxRetries) {
                    try {
                        response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.ok) {
                            break;
                        } else if (response.status === 429) {
                            const delay = initialDelay * Math.pow(2, retries);
                            console.warn(`Too many requests. Retrying in ${delay}ms...`);
                            await new Promise(res => setTimeout(res, delay));
                            retries++;
                        } else {
                            throw new Error(`API error: ${response.status} ${response.statusText}`);
                        }
                    } catch (error) {
                        console.error('Fetch error:', error);
                        break;
                    }
                }

                if (!response || !response.ok) {
                    throw new Error('Failed to get a valid response from the API after multiple retries.');
                }
                
                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 && 
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const botResponse = result.candidates[0].content.parts[0].text;
                    
                    chatHistory.push({ role: "user", parts: [{ text: userMessage }] });
                    chatHistory.push({ role: "model", parts: [{ text: botResponse }] });

                    hideTypingIndicator();
                    addMessage('bot', botResponse);
                } else {
                    hideTypingIndicator();
                    addMessage('bot', '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶ï‡ßã‡¶®‡ßã ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§');
                }

            } catch (error) {
                console.error('Error during API call:', error);
                hideTypingIndicator();
                addMessage('bot', '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
            } finally {
                isProcessing = false;
            }
        }

        // Event listener for send button
        sendBtn.addEventListener('click', sendMessage);

        // Event listener for "Enter" key press on input field
        userInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
